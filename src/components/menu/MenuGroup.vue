<!--
  –ö–û–ú–ü–û–ù–ï–ù–¢ –ì–†–£–ü–ü–´ –ú–ï–ù–Æ
  
  –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–µ–∫—Ü–∏—é (–≥—Ä—É–ø–ø—É) –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é
  —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ 
  –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –º–µ–Ω—é.
  
  –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é —Å –∏–∫–æ–Ω–∫–æ–π –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º
  - –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ç–∏–ø–æ–≤ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤:
    * –û–±—ã—á–Ω—ã–µ Vue –º–∞—Ä—à—Ä—É—Ç—ã (RouterLink –Ω–∞–≤–∏–≥–∞—Ü–∏—è)
    * BI offcanvas –≤–∫–ª–∞–¥–∫–∏ (emit —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏)
  - –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ/–ø–æ–∫–∞–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç hover —Å–æ—Å—Ç–æ—è–Ω–∏—è
  - –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã/—Ä–∞–∑–¥–µ–ª–∞
  - –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
  
  Props:
  - data: –æ–±—ä–µ–∫—Ç —Å–µ–∫—Ü–∏–∏ –º–µ–Ω—é –∏–∑ menu-sections.js
  - isOpen: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏ –≥—Ä—É–ø–ø—ã
  - isCollapsed: —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –º–µ–Ω—é
  - isHovering: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —Å–≤–µ—Ä–Ω—É—Ç–æ–µ –º–µ–Ω—é
  - currentPage: —Ç–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
  
  –°–æ–±—ã—Ç–∏—è:
  - toggle: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥—Ä—É–ø–ø—ã
  - navigate: –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è offcanvas –≤–∫–ª–∞–¥–æ–∫
  - reset-page: —Å–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
-->

<script setup>
import { ChevronRight, Dot } from 'lucide-vue-next'
import { computed } from 'vue'
import { useRouter, useRoute } from 'vue-router'

const props = defineProps({
  data: { type: Object, required: true },
  isOpen: { type: Boolean, required: true },
  isCollapsed: { type: Boolean, required: true },
  isHovering: { type: Boolean, required: true },
  currentPage: { type: String, required: true },
})

const showFull = computed(() => props.isCollapsed || props.isHovering)

const router = useRouter()
const route = useRoute()
const emit = defineEmits(['toggle', 'action', 'navigate', 'reset-page'])

const isCurrentRoute = computed(() => {
  return route.name === props.data.routeName
})

const isCurrentGroupPage = computed(() => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≥—Ä—É–ø–ø—ã
  if (route.name === props.data.routeName) {
    return true
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –æ–¥–Ω–æ–π –∏–∑ –ø–æ–¥—Å—Ç—Ä–∞–Ω–∏—Ü –≥—Ä—É–ø–ø—ã
  if (props.data.list) {
    return props.data.list.some(item => {
      // –î–ª—è –æ–±—ã—á–Ω—ã—Ö Vue —Å—Ç—Ä–∞–Ω–∏—Ü
      if (item.path && route.name === item.path) {
        return true
      }
      // –î–ª—è BI offcanvas —Å—Ç—Ä–∞–Ω–∏—Ü
      if (item.isOffcanvas && item.page === props.currentPage) {
        return true
      }
      return false
    })
  }
  
  return false
})

function emitNavigate(item) {
  if (item.page) {
    emit('navigate', item)
  }
}

function routeClick(event) {
  event.preventDefault() // –í—Å–µ–≥–¥–∞ –±–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é RouterLink
  
  if (props.data.list) {
    // –ï—Å–ª–∏ —É —ç–ª–µ–º–µ–Ω—Ç–∞ –µ—Å—Ç—å –ø–æ–¥–º–µ–Ω—é
    if (props.isOpen) {
      // –ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –æ—Ç–∫—Ä—ã—Ç–∞ - –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º, –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∏–∫—É–¥–∞
      emit('toggle')
    } 
    else {
      // –ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –∑–∞–∫—Ä—ã—Ç–∞ - –æ—Ç–∫—Ä—ã–≤–∞–µ–º
      emit('toggle')
      
      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã
      if (!isCurrentGroupPage.value) {
        router.push({ name: props.data.routeName })
      }
    }
  } else {
    // –ï—Å–ª–∏ –ø–æ–¥–º–µ–Ω—é –Ω–µ—Ç - –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    router.push({ name: props.data.routeName })
  }
}

</script>

<template>
  <li class="side-menu__group side-group">
    <div
      class="side-title nav-btn"
      :class="{ 'side-title--active': isCurrentRoute }"
      @click="routeClick($event)"
    >
      <div class="side-title__label">
        <div class="side-icon icon-flex">
          <component :is="data.icon" :size="20" />
        </div>
        <div class="side-title__name text-smooth-animation" :class="{ hidden: !isHovering }">
          {{ data.title }}
        </div>
      </div>
      <div v-if="isHovering && data.list" class="nav-icon icon-flex">
        <ChevronRight :size="20" :class="{ rotated: isOpen }" />
      </div>
    </div>

    <ul
      v-if="data.list"
      class="side-group__list"
      :class="showFull ? (isOpen ? 'is-open' : '') : ''"
    >
      <li
        v-for="(item, index) in data.list"
        :key="index"
        class="side-group__list-item"
        :style="{ transitionDelay: `${index * 50}ms` }"
      >
        <!-- üî∑ BI-–≤–∫–ª–∞–¥–∫–∏ -->
        <template v-if="item.isOffcanvas">
          <a
            href="#"
            class="side-subtitle nav-btn"
            :class="{ 'side-subtitle--active': item.page === currentPage }"
            @click.prevent="emitNavigate(item)"
          >
            <div class="side-subtitle__label">
              <div class="nav-icon icon-flex"><Dot :size="20" /></div>
              <div
                v-if="showFull"
                class="d-inline-block text-truncate side-subtitle__name"
                style="max-width: 9.375rem"
                :title="item.name"
              >
                {{ item.name }}
              </div>
            </div>
          </a>
        </template>

        <!-- üî∂ –û–±—ã—á–Ω—ã–µ Vue —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <template v-else>
          <RouterLink
            :to="{ name: item.path }"
            class="side-subtitle nav-btn"
            active-class="side-subtitle--active"
            exact-active-class="side-subtitle--exact-active"
          >
            <div class="side-subtitle__label">
              <div class="nav-icon icon-flex"><Dot :size="20" /></div>
              <div
                v-if="showFull"
                class="d-inline-block text-truncate side-subtitle__name"
                style="max-width: 9.375rem"
                :title="item.name"
              >
                {{ item.name }}
              </div>
            </div>
          </RouterLink>
        </template>
      </li>
    </ul>
  </li>
</template>

<style lang="scss" scoped>
.side-group {
  @include flex-column-gap(2px);
}

.side-title,
.side-subtitle {
  @include flex-row-gap(0, center, space-between);
  cursor: pointer;
  color: var(--color-primary-text);
  text-decoration: none;

  &__label {
    @include flex-row-gap($padding-internal, center, space-between);
  }
}

.side-title--active {
  color: var(--bs-primary);
  background-color: var(--bs-primary-bg-subtle);
}
.side-subtitle--active .nav-icon,
.side-subtitle--active .side-subtitle__name {
  color: var(--bs-primary);
  padding-left: 0.5rem;
}

.nav-btn {
  padding: $padding-internal $padding-external;
  border-radius: $radius-small;
  transition: all $transition;
  overflow: hidden;

  &:not(.side-title--active):hover {
    background-color: var(--color-secondary-background);
  }
  &.side-title--active:hover {
    background-color: var(--bs-primary-border-subtle);
  }
}

.side-subtitle--active {
  background-color: var(--bs-primary-bg-subtle);
  color: var(--bs-primary);
}

.side-title__name {
  white-space: nowrap;
}

.nav-icon svg {
  transition: transform 0.3s ease;
}
.rotated {
  transform: rotate(90deg);
}

.side-group__list {
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  padding: 0;
  margin: 0;
  list-style: none;

  transition:
    max-height 0.5s ease,
    opacity 0.5s ease-in-out;
}

.side-group__list.is-open {
  max-height: none;
  opacity: 1;
}

.side-group__list-item {
  opacity: 0;
  transform: translateY(-10px);
  transition:
    opacity 0.3s ease,
    transform 0.3s ease;
}

.side-group__list.is-open .side-group__list-item {
  opacity: 1;
  transform: translateY(0);
}
</style>
